<section class="page">
  <header class="page-header">
    <div>
      <h1 class="page-title">Suggestions</h1>
      <p class="page-subtitle">Review project and tag suggestions.</p>
    </div>
  </header>

  <div class="card-grid">
    <mat-card class="panel">
      <mat-card-title>Project suggestions</mat-card-title>
      <mat-card-content>
        <div class="panel-actions" data-testid="project-suggestions-actions">
          <button
            mat-stroked-button
            data-testid="project-suggestions-run-regression-btn"
            [disabled]="isRegressionBusy"
            (click)="runRegressionReport()"
          >
            Run regression report
          </button>
          <button
            mat-stroked-button
            data-testid="project-suggestions-export-regression-btn"
            [disabled]="isRegressionBusy"
            (click)="exportRegressionReport()"
          >
            Export regression JSON
          </button>
          <button
            mat-raised-button
            color="primary"
            data-testid="project-suggestions-accept-all-btn"
            (click)="acceptAllProjects()"
          >
            Accept all
          </button>
          <button
            mat-stroked-button
            color="warn"
            data-testid="project-suggestions-reject-all-btn"
            (click)="rejectAllProjects()"
          >
            Reject all
          </button>
        </div>
        <app-project-suggestion-list mode="suggestions" />
      </mat-card-content>
    </mat-card>
    <mat-card class="panel">
      <mat-card-title>Tag suggestions</mat-card-title>
      <mat-card-content>
        <app-tag-suggestion-list />
      </mat-card-content>
    </mat-card>
  </div>

  <mat-card class="panel regression-panel" *ngIf="regressionReport || regressionError">
    <mat-card-title>Heuristics regression report</mat-card-title>
    <mat-card-content>
      <p class="regression-error" *ngIf="regressionError" data-testid="regression-report-error">
        {{ regressionError }}
      </p>

      <div *ngIf="regressionReport" data-testid="regression-report-summary">
        <div class="regression-summary-grid">
          <div><strong>Roots analyzed:</strong> {{ regressionReport.rootsAnalyzed }}</div>
          <div><strong>Baseline accepted:</strong> {{ regressionReport.baselineAcceptedCount }}</div>
          <div><strong>Baseline rejected:</strong> {{ regressionReport.baselineRejectedCount }}</div>
          <div><strong>Accepted missing:</strong> {{ regressionReport.acceptedMissingCount }}</div>
          <div><strong>Rejected missing:</strong> {{ regressionReport.rejectedMissingCount }}</div>
          <div><strong>Added:</strong> {{ regressionReport.addedCount }}</div>
        </div>

        <div class="regression-roots" data-testid="regression-report-roots">
          <div class="regression-root" *ngFor="let root of regressionReport.roots">
            <div class="regression-root-title">{{ root.rootPath }}</div>
            <div class="regression-root-row">
              <span>Accepted missing: {{ root.acceptedMissingCount }}</span>
              <span>Rejected missing: {{ root.rejectedMissingCount }}</span>
              <span>Added: {{ root.addedCount }}</span>
            </div>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</section>
