<div class="layout-toggle">
  <div class="layout-actions" data-testid="tag-suggestions-actions">
    <button
      mat-raised-button
      color="primary"
      *ngIf="scope === 'pending'"
      data-testid="tag-suggestions-accept-all-btn"
      (click)="acceptAll()"
    >
      Accept all
    </button>
    <button
      mat-stroked-button
      color="warn"
      *ngIf="scope === 'pending'"
      data-testid="tag-suggestions-reject-all-btn"
      (click)="rejectAll()"
    >
      Reject all
    </button>
  </div>
</div>

<div class="list-toolbar">
  <mat-form-field appearance="outline" class="toolbar-field">
    <mat-label>Search</mat-label>
    <input
      matInput
      [placeholder]="isSearchEnabled ? 'Search in selected sort field' : 'Search disabled for Created'"
      [disabled]="!isSearchEnabled"
      [value]="searchTerm"
      (input)="searchTerm = $any($event.target).value"
      data-testid="tag-suggest-search"
    />
  </mat-form-field>

  <mat-form-field appearance="outline" class="toolbar-field">
    <mat-label>Sort</mat-label>
    <mat-select
      [value]="sortKey"
      (selectionChange)="onSortKeyChange($event.value)"
      data-testid="tag-suggest-sort"
    >
      <mat-option value="projectName">Project</mat-option>
      <mat-option value="tagName">Tag</mat-option>
      <mat-option value="createdAt">Created</mat-option>
    </mat-select>
  </mat-form-field>

  <mat-button-toggle-group
    class="sort-dir"
    [value]="sortDir"
    (change)="sortDir = $event.value"
    aria-label="Tag suggestions sort direction"
    data-testid="tag-suggest-sort-dir"
  >
    <mat-button-toggle value="asc">Asc</mat-button-toggle>
    <mat-button-toggle value="desc">Desc</mat-button-toggle>
  </mat-button-toggle-group>
</div>

<div class="controls-row">
  <mat-button-toggle-group
    class="scope-toggle"
    [value]="scope"
    (change)="scope = $event.value"
    aria-label="Tag suggestions scope"
    data-testid="tag-suggest-scope"
  >
    <mat-button-toggle value="pending">Pending</mat-button-toggle>
    <mat-button-toggle value="accepted">Accepted</mat-button-toggle>
    <mat-button-toggle value="rejected">Rejected</mat-button-toggle>
  </mat-button-toggle-group>

  <span class="spacer"></span>

  <mat-button-toggle-group
    class="layout-switch"
    [value]="layout"
    (change)="layout = $event.value"
    aria-label="Tag suggestions layout"
    data-testid="tag-suggest-layout"
  >
    <mat-button-toggle value="list">List</mat-button-toggle>
    <mat-button-toggle value="grid">Grid</mat-button-toggle>
  </mat-button-toggle-group>

  <label class="grid-size" data-testid="tag-suggest-grid-size-wrap">
    <span>Card size (grid)</span>
    <input
      type="range"
      min="85"
      max="130"
      step="5"
      [disabled]="layout !== 'grid'"
      [value]="gridCardSizePercent"
      (input)="gridCardSizePercent = +$any($event.target).value"
      data-testid="tag-suggest-grid-size"
    />
  </label>
</div>

<div
  class="suggestion-list"
  [class.layout-grid]="layout === 'grid'"
  [style.--grid-card-scale]="gridScaleFactor"
  data-testid="tag-suggest-list"
>
  <mat-card
    *ngFor="let item of visibleItems"
    class="suggestion-card"
    [class.is-open]="layout === 'grid' ? true : item.id === openId"
    [class.is-grid]="layout === 'grid'"
  >
    <div class="header-row" (click)="toggleDetails(item.id)" role="button" tabindex="0">
      <div class="title-block">
        <span class="name">{{ item.projectName }}</span>
        <span class="kind">{{ item.type }} Â· {{ item.tagName }}</span>
      </div>
      <div class="meta">
        <span class="score">Conf {{ item.confidence }}</span>
        <span class="status" [attr.data-status]="item.status">{{ item.status }}</span>
        <span class="chevron" aria-hidden="true"></span>
      </div>
    </div>

    <div
      class="details-wrap"
      [attr.data-open]="layout === 'grid' ? true : item.id === openId"
    >
      <div class="details">
        <div class="detail-row">
          <span class="detail-label">Tag</span>
          <strong>{{ item.tagName }}</strong>
        </div>
        <div class="detail-row">
          <span class="detail-label">Source</span>
          <strong>{{ item.source }}</strong>
        </div>
        <div class="detail-row">
          <span class="detail-label">Reason</span>
          <strong>{{ item.reason }}</strong>
        </div>
        <div class="detail-row">
          <span class="detail-label">Created</span>
          <strong>{{ item.createdAt }}</strong>
        </div>
      </div>

      <div class="actions">
        <button
          mat-stroked-button
          color="primary"
          *ngIf="item.status === 'pending'"
          (click)="accept(item)"
        >
          Accept
        </button>
        <button
          mat-stroked-button
          color="warn"
          *ngIf="item.status === 'pending'"
          (click)="reject(item)"
        >
          Reject
        </button>
        <button
          mat-stroked-button
          color="warn"
          *ngIf="item.status === 'rejected'"
          (click)="deleteSuggestion(item)"
          [attr.data-testid]="'tag-suggest-delete-btn-' + item.id"
        >
          Delete
        </button>
      </div>
    </div>
  </mat-card>
</div>

<p class="empty-state" *ngIf="visibleItems.length === 0" data-testid="tag-suggest-empty">
  No tag suggestions in this scope.
</p>
